<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="Darya Vanichkina PhD">
    <meta name="description" content="Using renv on a PBS-Pro HPC cluster Today someone asked about my workflow for using R on an HPC cluster, and - more specifically - about how to install packages when executing a workflow that requires use of HPC. Google wasn&rsquo;t helpful with providing a link to share - so the onus is on me to write the blog post.
The &ldquo;why&rdquo; Just like working on our local machines, when working on an HPC cluster we really want to be able to have a consistent R environment for each of our projects that we snapshot at the time of working on said project.">
    <meta name="keywords" content="data scientist, bioinformatician, consultant, educator">

    
      <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" crossorigin="anonymous"></script>
    

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Installing packages on a PBS-Pro HPC cluster using renv"/>
<meta name="twitter:description" content="Using renv on a PBS-Pro HPC cluster Today someone asked about my workflow for using R on an HPC cluster, and - more specifically - about how to install packages when executing a workflow that requires use of HPC. Google wasn&rsquo;t helpful with providing a link to share - so the onus is on me to write the blog post.
The &ldquo;why&rdquo; Just like working on our local machines, when working on an HPC cluster we really want to be able to have a consistent R environment for each of our projects that we snapshot at the time of working on said project."/>

    <meta property="og:title" content="Installing packages on a PBS-Pro HPC cluster using renv" />
<meta property="og:description" content="Using renv on a PBS-Pro HPC cluster Today someone asked about my workflow for using R on an HPC cluster, and - more specifically - about how to install packages when executing a workflow that requires use of HPC. Google wasn&rsquo;t helpful with providing a link to share - so the onus is on me to write the blog post.
The &ldquo;why&rdquo; Just like working on our local machines, when working on an HPC cluster we really want to be able to have a consistent R environment for each of our projects that we snapshot at the time of working on said project." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://daryavanichkina.com/posts/2021-07-28-renvhpc/" />
<meta property="article:published_time" content="2021-07-28T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-07-28T00:00:00+00:00" />


    <title>
  Installing packages on a PBS-Pro HPC cluster using renv ¬∑ Darya Vanichkina
</title>

    
      <link rel="canonical" href="https://daryavanichkina.com/posts/2021-07-28-renvhpc/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://daryavanichkina.com/css/coder.min.9836c03fe5c87d102278a33e86d0591ef36c89b1e17e8e547ebf84c05cee010e.css" integrity="sha256-mDbAP&#43;XIfRAieKM&#43;htBZHvNsibHhfo5Ufr&#43;EwFzuAQ4=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="https://daryavanichkina.com/css/coder-dark.min.717236c74e0a5208ef73964a9f44c6b443b689a95b270d8b2a40d0c012460dac.css" integrity="sha256-cXI2x04KUgjvc5ZKn0TGtEO2ialbJw2LKkDQwBJGDaw=" crossorigin="anonymous" media="screen" />
      
    

    
      <link rel="stylesheet" href="https://daryavanichkina.com/static/css/custom.css" />
    

    

    <link rel="icon" type="image/png" href="https://daryavanichkina.com/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://daryavanichkina.com/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="https://daryavanichkina.com/images/apple-touch-icon.png">
    <link rel="apple-touch-icon"  sizes="180x180" href="https://daryavanichkina.com/images/apple-touch-icon.png">

    <meta name="generator" content="Hugo 0.80.0" />
  </head>
  
  
  
    
  
  <body class="colorscheme-auto"
        onload=" twemoji.parse(document.body); "
  >
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://daryavanichkina.com/">
      Darya Vanichkina
    </a>
    
      <span id="dark-mode-toggle" class="float-right">
        <i class="fas fa-adjust fa-fw"></i>
      </span>
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fas fa-bars fa-fw"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://daryavanichkina.com/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://daryavanichkina.com/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://daryavanichkina.com/training/">Training</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://daryavanichkina.com/contact/">Contact</a>
            </li>
          
        
        
        <li class="navigation-item separator">
          <span>|</span>
        </li>
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Installing packages on a PBS-Pro HPC cluster using renv</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2021-07-28T00:00:00Z'>
                July 28, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              8-minute read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://daryavanichkina.com/tags/data-science/">Data science</a>
      <span class="separator">‚Ä¢</span>
    <a href="https://daryavanichkina.com/tags/r/">R</a>
      <span class="separator">‚Ä¢</span>
    <a href="https://daryavanichkina.com/tags/workjournal/">WorkJournal</a>
      <span class="separator">‚Ä¢</span>
    <a href="https://daryavanichkina.com/tags/compute/">compute</a></div>

        </div>
      </header>

      <div>
        
        <h2 id="using-renv-on-a-pbs-pro-hpc-cluster">Using renv on a PBS-Pro HPC cluster</h2>
<p>Today someone asked about my workflow for using R on an HPC cluster, and - more specifically - about how to install packages when executing a workflow that requires use of HPC. Google wasn&rsquo;t helpful with providing a link to share - so the onus is on me to write <em>the</em> blog post.</p>
<p><img src="https://source.unsplash.com/E2qx9Ed2qIQ/800x600" alt="suitcase"></p>
<h3 id="the-why">The &ldquo;why&rdquo;</h3>
<p>Just like working on our local machines, when working on an HPC cluster we really want to be able to have a consistent R environment for each of our projects that we snapshot at the time of working on said project. This means code that was written months or even years ago will still work as expected, even if the packages on CRAN have since been updated with breaking changes. The <a href="https://rstudio.github.io/renv/index.html"><code>renv</code></a> package is brilliant at managing this - however, it is not intuitive to figure out how to use it when working on an HPC cluster - which is what I work through in the below post.</p>
<h3 id="assumptions">Assumptions</h3>
<p>This post makes a few assumptions:</p>
<ol>
<li>You are planning to use R for analysis, and know how to install packages on your local machine.</li>
<li>You are working with a PBS-Pro HPC cluster, and know all of the core commands (this is not an introduction to <code>ssh</code>, <code>qsub</code>, <code>module load</code> etc - see <a href="https://sydney-informatics-hub.github.io/training.artemis.introhpc/">here</a> for an intro). I <em>think</em> some of the below should generalise to SLURM or other cluster schedulers, but don&rsquo;t have access to them so can&rsquo;t test.</li>
<li>You want to use the <a href="https://rstudio.github.io/renv/articles/renv.html"><code>renv</code></a> library to manage the packages in your project (You do, you really do - I cannot recommend this highly enough, especially for sanity of future you). You know the basics of using <code>renv</code> on your local machine, as per <a href="https://rstudio.github.io/renv/articles/renv.html">the <code>renv</code> vignette</a> - that&rsquo;s probably the best intro to <code>renv</code>.</li>
</ol>
<p>Oof, now that that&rsquo;s out of the way, let&rsquo;s dive in üê¨ &hellip;</p>
<h3 id="step-1-ssh-into-your-cluster-and-fire-up-an-interactive-session">Step 1: <code>ssh</code> into your cluster and fire up an interactive session</h3>
<p>After you login to your HPC server, I recommend starting up an interactive session so you&rsquo;re not working on and hence clogging up the login nodes. (You can do this on a login node too, but depending on how much compute prototyping your analysis requires this may crash üî• - or get you a cranky email from an admin üò° ).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">qsub -I -l walltime<span style="color:#f92672">=</span>4:0:0 -l <span style="color:#66d9ef">select</span><span style="color:#f92672">=</span>1:ncpus<span style="color:#f92672">=</span>1:mem<span style="color:#f92672">=</span>10gb
</code></pre></div><h3 id="step-2-launch-r-and-install-renv">Step 2: Launch R and install renv</h3>
<p>After you&rsquo;re logged in to the worker node, run the following commands to:</p>
<ul>
<li>navigate to the project directory</li>
<li>get rid of everything that may have inadvertently been preloaded</li>
<li>launch R</li>
<li>install <code>renv</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cd myprojectdirectory
module purge
module load R/4.0.4 <span style="color:#75715e"># &lt;- or whatver version or R is available on your cluster</span>
R
</code></pre></div><p>This will open the R command line interface.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;renv&#34;</span>)
</code></pre></div><p>This will return the details that the installation of <code>renv()</code> will occur into a default location:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">Installing package into ‚Äò/home/myusername/R/x86_64-pc-linux-gnu-library/4.0‚Äô
</code></pre></div><p>And ask me to select a CRAN mirror for installation; after choosing the appropriate mirror and pressing return the package will be installed.</p>
<h3 id="step-3-install-the-packages-you-need-ideally-prototype-your-analysis-and-snapshot-the-installs-using-renv">Step 3: Install the packages you need, (ideally) prototype your analysis and snapshot the installs using <code>renv</code></h3>
<p>For this demo, I am going to assume that my project depends on the <code>tidyverse</code> family of libraries, and that I want to install them in one go. (<em>In real life, I actually avoid taking this approach, and instead install each of the tidyverse libraries one by one as I use and need them.</em>)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">library</span>(renv)
<span style="color:#75715e"># initialise renv</span>
renv<span style="color:#f92672">::</span><span style="color:#a6e22e">init</span>()
</code></pre></div><p>This will ask me to restart R, after doing which I can start installing packages.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;tidyverse&#34;</span>)
<span style="color:#75715e"># wait... and wait... for packages to successfully install</span>
<span style="color:#a6e22e">library</span>(tidyverse)
</code></pre></div><p>I would next prototype my analysis code, installing as many packages as I need using the normal <code>install.packages()</code> syntax - and eventually wrap the analysis up into a script.</p>
<p>After you have installed all of the libraries you need, in the interactive R session, exectute the following command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># this will tell you whether renv has captured versions </span>
<span style="color:#75715e"># of all of the packages you need to install</span>
renv<span style="color:#f92672">::</span><span style="color:#a6e22e">status</span>()
<span style="color:#75715e"># if the result of renv::status() was not </span>
<span style="color:#75715e"># &#34;The project is already synchronized with the lockfile.&#34;</span>
<span style="color:#75715e"># run the below command to snapshot all currently installed libraries</span>
renv<span style="color:#f92672">::</span><span style="color:#a6e22e">snapshot</span>()
</code></pre></div><p>For this demo, I&rsquo;m going to assume I want to run the following command that uses the built-in <code>gss_cat</code> dataset from the <code>forcats</code> package, the pipe and the <code>dplyr::filter()</code> command - so nicely tests a few of the <code>tidyverse</code> libraries in one line:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">gss_cat <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">head</span>() <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">filter</span>(tvhours <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>)
</code></pre></div><p>The output should be:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt"># A tibble: 3 √ó 9
   year marital      age race  rincome    partyid     relig     denom    tvhours
  &lt;int&gt; &lt;fct&gt;      &lt;int&gt; &lt;fct&gt; &lt;fct&gt;      &lt;fct&gt;       &lt;fct&gt;     &lt;fct&gt;      &lt;int&gt;
1  2000 Widowed       67 White Not appli‚Ä¶ Independent Protesta‚Ä¶ No deno‚Ä¶       2
2  2000 Never mar‚Ä¶    39 White Not appli‚Ä¶ Ind,near r‚Ä¶ Orthodox‚Ä¶ Not app‚Ä¶       4
3  2000 Divorced      25 White Not appli‚Ä¶ Not str de‚Ä¶ None      Not app‚Ä¶       1
</code></pre></div><h3 id="optional-step-3a-look-at-the-renvlock-file-to-see-all-of-the-packages-you-have-installed-into-the-project">(Optional) Step 3a: Look at the <code>renv.lock</code> file to see all of the packages you have installed into the project</h3>
<p>The <code>renv.lock</code> file stores details about the R version and all of the packages that are installed in your environment in <code>.json</code> format. So installing the <code>tidyverse</code> packages in one fell swoop like I did above results in quite a long list of libraries (last 5 shown here):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"> <span style="color:#e6db74">&#34;vroom&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
      <span style="color:#f92672">&#34;Package&#34;</span>: <span style="color:#e6db74">&#34;vroom&#34;</span>,
      <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;1.5.3&#34;</span>,
      <span style="color:#f92672">&#34;Source&#34;</span>: <span style="color:#e6db74">&#34;Repository&#34;</span>,
      <span style="color:#f92672">&#34;Repository&#34;</span>: <span style="color:#e6db74">&#34;CRAN&#34;</span>,
      <span style="color:#f92672">&#34;Hash&#34;</span>: <span style="color:#e6db74">&#34;aac6012f34348b3ca6bf373fe7172b06&#34;</span>
    }<span style="color:#960050;background-color:#1e0010">,</span>
    <span style="color:#e6db74">&#34;withr&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
      <span style="color:#f92672">&#34;Package&#34;</span>: <span style="color:#e6db74">&#34;withr&#34;</span>,
      <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2.4.2&#34;</span>,
      <span style="color:#f92672">&#34;Source&#34;</span>: <span style="color:#e6db74">&#34;Repository&#34;</span>,
      <span style="color:#f92672">&#34;Repository&#34;</span>: <span style="color:#e6db74">&#34;CRAN&#34;</span>,
      <span style="color:#f92672">&#34;Hash&#34;</span>: <span style="color:#e6db74">&#34;ad03909b44677f930fa156d47d7a3aeb&#34;</span>
    }<span style="color:#960050;background-color:#1e0010">,</span>
    <span style="color:#e6db74">&#34;xfun&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
      <span style="color:#f92672">&#34;Package&#34;</span>: <span style="color:#e6db74">&#34;xfun&#34;</span>,
      <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;0.24&#34;</span>,
      <span style="color:#f92672">&#34;Source&#34;</span>: <span style="color:#e6db74">&#34;Repository&#34;</span>,
      <span style="color:#f92672">&#34;Repository&#34;</span>: <span style="color:#e6db74">&#34;CRAN&#34;</span>,
      <span style="color:#f92672">&#34;Hash&#34;</span>: <span style="color:#e6db74">&#34;88cdb9779a657ad80ad942245fffba31&#34;</span>
    }<span style="color:#960050;background-color:#1e0010">,</span>
    <span style="color:#e6db74">&#34;xml2&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
      <span style="color:#f92672">&#34;Package&#34;</span>: <span style="color:#e6db74">&#34;xml2&#34;</span>,
      <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;1.3.2&#34;</span>,
      <span style="color:#f92672">&#34;Source&#34;</span>: <span style="color:#e6db74">&#34;Repository&#34;</span>,
      <span style="color:#f92672">&#34;Repository&#34;</span>: <span style="color:#e6db74">&#34;CRAN&#34;</span>,
      <span style="color:#f92672">&#34;Hash&#34;</span>: <span style="color:#e6db74">&#34;d4d71a75dd3ea9eb5fa28cc21f9585e2&#34;</span>
    }<span style="color:#960050;background-color:#1e0010">,</span>
    <span style="color:#e6db74">&#34;yaml&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
      <span style="color:#f92672">&#34;Package&#34;</span>: <span style="color:#e6db74">&#34;yaml&#34;</span>,
      <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2.2.1&#34;</span>,
      <span style="color:#f92672">&#34;Source&#34;</span>: <span style="color:#e6db74">&#34;Repository&#34;</span>,
      <span style="color:#f92672">&#34;Repository&#34;</span>: <span style="color:#e6db74">&#34;CRAN&#34;</span>,
      <span style="color:#f92672">&#34;Hash&#34;</span>: <span style="color:#e6db74">&#34;2826c5d9efb0a88f657c7a679c7106db&#34;</span>
    }
</code></pre></div><p>I sometimes find that <code>renv::status()</code> and <code>renv::snapshot()</code> in step 3 don&rsquo;t immediately see all of the libraries I have installed in the environment, and - weirdly - I need to restart R and run <code>renv::status()</code> again before it will detect that a bunch of libraries have been installed. So if you&rsquo;re missing libraries in the <code>renv.lock</code> file you know need to be there - restarting R and re-running <code>renv::status()</code> and <code>renv::snapshot()</code> may be the way to go.</p>
<h3 id="step-4-save-your-script-and-submit-it-via-pbs">Step 4: Save your script and submit it via PBS</h3>
<p>Wrap the above code into <code>myscript.R</code> , with the following contents:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">library</span>(tidyverse)
gss_cat <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">head</span>() <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">filter</span>(tvhours <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>)
</code></pre></div><p>Then create a shell script (<code>myshellscript.sh</code>) that can be submitted to the PBS queue:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#! /bin/bash
</span><span style="color:#75715e"></span>module purge
module load R/4.0.4
cd /to/my/projectpath
Rscript myscript.R
</code></pre></div><p>Finally, submit to the queue:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">qsub -l walltime<span style="color:#f92672">=</span>0:10:0 -l <span style="color:#66d9ef">select</span><span style="color:#f92672">=</span>1:ncpus<span style="color:#f92672">=</span>1:mem<span style="color:#f92672">=</span>1gb -N mytestscript myshellscript.sh
</code></pre></div><p>Note that I&rsquo;m only asking for 1 Gb of RAM and 10 minutes of walltime. This is probably a lot less than you&rsquo;d need for any &ldquo;real&rdquo; analysis - but it&rsquo;s perfectly fine for my script above.</p>
<p>After that executes, I get the following output in <code>mytestscript.o123456</code>, where 123456 is the job number that my PBS scheduler automatically assigned to my script run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># A tibble: 3 √ó 9</span>
   year marital      age race  rincome    partyid     relig     denom    tvhours
  <span style="color:#f92672">&lt;</span>int<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span>fct<span style="color:#f92672">&gt;</span>      <span style="color:#f92672">&lt;</span>int<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span>fct<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span>fct<span style="color:#f92672">&gt;</span>      <span style="color:#f92672">&lt;</span>fct<span style="color:#f92672">&gt;</span>       <span style="color:#f92672">&lt;</span>fct<span style="color:#f92672">&gt;</span>     <span style="color:#f92672">&lt;</span>fct<span style="color:#f92672">&gt;</span>      <span style="color:#f92672">&lt;</span>int<span style="color:#f92672">&gt;</span>
<span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">2000</span> Widowed       <span style="color:#ae81ff">67</span> White Not appli‚Ä¶ Independent Protesta‚Ä¶ No deno‚Ä¶       <span style="color:#ae81ff">2</span>
<span style="color:#ae81ff">2</span>  <span style="color:#ae81ff">2000</span> Never mar‚Ä¶    <span style="color:#ae81ff">39</span> White Not appli‚Ä¶ Ind,near r‚Ä¶ Orthodox‚Ä¶ Not app‚Ä¶       <span style="color:#ae81ff">4</span>
<span style="color:#ae81ff">3</span>  <span style="color:#ae81ff">2000</span> Divorced      <span style="color:#ae81ff">25</span> White Not appli‚Ä¶ Not str de‚Ä¶ None      Not app‚Ä¶       <span style="color:#ae81ff">1</span>
</code></pre></div><p>And the package loading messages in <code>mytestscript.e123456</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">Warning message<span style="color:#f92672">:</span>
renv took longer than <span style="color:#a6e22e">expected </span>(<span style="color:#ae81ff">66</span> seconds) to activate the sandbox.

The sandbox can be disabled by setting<span style="color:#f92672">:</span>

    RENV_CONFIG_SANDBOX_ENABLED <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>

within an appropriate start<span style="color:#f92672">-</span>up .Renviron file. See `?renv::config` for more details.
Warning<span style="color:#f92672">:</span> program compiled against libxml <span style="color:#ae81ff">209</span> using older <span style="color:#ae81ff">207</span>
‚îÄ‚îÄ Attaching packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse <span style="color:#ae81ff">1.3.1</span> ‚îÄ‚îÄ
‚úî ggplot2 <span style="color:#ae81ff">3.3.5</span>     ‚úî purrr   <span style="color:#ae81ff">0.3.4</span>
‚úî tibble  <span style="color:#ae81ff">3.1.3</span>     ‚úî dplyr   <span style="color:#ae81ff">1.0.7</span>
‚úî tidyr   <span style="color:#ae81ff">1.1.3</span>     ‚úî stringr <span style="color:#ae81ff">1.4.0</span>
‚úî readr   <span style="color:#ae81ff">2.0.0</span>     ‚úî forcats <span style="color:#ae81ff">0.5.1</span>
‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ <span style="color:#a6e22e">tidyverse_conflicts</span>() ‚îÄ‚îÄ
‚úñ dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">filter</span>() masks stats<span style="color:#f92672">::</span><span style="color:#a6e22e">filter</span>()
‚úñ dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">lag</span>()    masks stats<span style="color:#f92672">::</span><span style="color:#a6e22e">lag</span>()
</code></pre></div><p>This includes a warning that the <code>renv</code> sandbox took a while to load, but this doesn&rsquo;t seem to affect functionality, so I haven&rsquo;t disabled it.</p>
<hr>
<p>That&rsquo;s it! Hopefully the above helps you use <code>renv()</code> with a PBS-Pro based HPC cluster üòä, and please do leave a comment if something isn&rsquo;t clear or doesn&rsquo;t work as expected.</p>
<h3 id="even-more-notes">(Even more) notes</h3>
<ol>
<li>This workflow means that your package install information (i.e. the binaries) are stored in the project folder, in the <code>renv</code> folder. So they are <em>not</em> stored on the worker nodes where your job is being executed, but instead in your home or project folder. This is a <em>good</em> thing, as it means you&rsquo;re not hitting up CRAN to install packages every time you run a job.</li>
<li>This workflow also means that while you can <code>rsync</code> your project folder from your local machine to the remove server (or prototype on your local machine), you will need to run <code>renv::restrore()</code> once on the &ldquo;other&rdquo; machine prior to being able to execute or deploy the script.</li>
</ol>

      </div>


      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "dvanicw" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
      
      
      
    </section>
  </footer>

    </main>

    
      
      <script src="https://daryavanichkina.com/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js"></script>
    

    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-54373354-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


    

    

  </body>

</html>
